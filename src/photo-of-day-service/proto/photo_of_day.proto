syntax = "proto3";

package photoofday;

service PhotoOfDayService {
    // Incrémenter (ajout de réaction)
    rpc IncrementReaction (IncrementReactionRequest) returns (IncrementReactionResponse);
    
    // ✨ NOUVEAU: Décrémenter (suppression de réaction)
    rpc DecrementReaction (DecrementReactionRequest) returns (IncrementReactionResponse);
    
    // ✨ NOUVEAU: Mettre à jour (modification de réaction)
    rpc UpdateReaction (UpdateReactionRequest) returns (IncrementReactionResponse);
    
    // Photo du jour
    rpc GetPhotoOfDay (GetPhotoOfDayRequest) returns (GetPhotoOfDayResponse);
    
    // Statistiques
    rpc GetPhotoStats (GetPhotoStatsRequest) returns (GetPhotoStatsResponse);
}

// Messages existants...
message IncrementReactionRequest {
    string display_name = 1;
    int32 photo_id = 2;
    string reaction_type = 3;
}

message IncrementReactionResponse {
    bool success = 1;
    string message = 2;
    int32 total_reactions = 3;
}

// ✨ NOUVEAUX messages
message DecrementReactionRequest {
    string display_name = 1;
    int32 photo_id = 2;
    string reaction_type = 3;  // Type de réaction supprimée
}

message UpdateReactionRequest {
    string display_name = 1;
    int32 photo_id = 2;
    string old_reaction_type = 3;  // Ancienne réaction
    string new_reaction_type = 4;  // Nouvelle réaction
}

// Messages existants pour GetPhotoOfDay et GetPhotoStats...
message GetPhotoOfDayRequest {
    int64 start_timestamp = 1;
    int64 end_timestamp = 2;
}

message GetPhotoOfDayResponse {
    bool found = 1;
    string display_name = 2;
    int32 photo_id = 3;
    int32 total_reactions = 4;
    map<string, int32> reaction_breakdown = 5;
    string photo_url = 6;
}

message GetPhotoStatsRequest {
    string display_name = 1;
    int32 photo_id = 2;
}

message GetPhotoStatsResponse {
    bool found = 1;
    string display_name = 2;
    int32 photo_id = 3;
    int32 total_reactions = 4;
    map<string, int32> reaction_breakdown = 5;
    int64 first_reaction_timestamp = 6;
    int64 last_reaction_timestamp = 7;
}